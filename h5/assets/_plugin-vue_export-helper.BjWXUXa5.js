import{p as e,q as o}from"./index-DsCaZWCH.js";const t="undefined"!=typeof wx&&e,r="undefined"!=typeof window&&window.location&&window.location.host.indexOf("vercel")>-1;async function s(e,s,n,c=1e4){const a=`${r?"/api/proxy?url=":"https://xjeubhfwkdwt.sealoshzh.site/api"}${e}`;if(console.log(`尝试${s}请求:`,{url:a,method:s,data:n,isH5:r,isMP:t}),t)return new Promise(((e,t)=>{const r=o({url:a,method:s,data:n,header:{"Content-Type":"application/json",Accept:"application/json"},success:o=>{console.log("请求成功:",o),o.data&&"object"==typeof o.data?e(o.data):(console.error("无效的响应数据:",o.data),t(new Error("服务器响应不是有效的JSON格式")))},fail:e=>{console.error("请求失败:",e),t(new Error(e.errMsg||"请求失败"))}});setTimeout((()=>{try{r.abort(),t(new Error("请求超时"))}catch(e){console.error("中止请求失败:",e)}}),c)}));try{let e,o;const t=new Promise(((e,t)=>{o=setTimeout((()=>t(new Error("请求超时"))),c)})),r=(async()=>{try{"undefined"!=typeof AbortController&&(e=new AbortController);const t={method:s,headers:{"Content-Type":"application/json",Accept:"application/json"}};"GET"!==s&&n&&(t.body=JSON.stringify(n)),e&&(t.signal=e.signal);let r=a;if("GET"===s&&n){const e=new URLSearchParams;Object.entries(n).forEach((([o,t])=>{null!=t&&e.append(o,t)})),r=`${a}${a.includes("?")?"&":"?"}${e.toString()}`}console.log("发送请求:",{url:r,method:s,headers:t.headers,body:t.body});const c=await fetch(r,t);if(console.log("收到响应:",{status:c.status,statusText:c.statusText,headers:Object.fromEntries(c.headers.entries())}),!c.ok)throw new Error(`请求失败: ${c.status}`);const l=c.headers.get("content-type");console.log("响应Content-Type:",l);const i=await c.text();let u;console.log("响应内容:",i);try{u=JSON.parse(i)}catch(o){throw console.error("JSON解析错误:",o),new Error("服务器响应不是有效的JSON格式")}if(!u||"object"!=typeof u)throw console.error("无效的响应数据:",u),new Error("服务器响应不是有效的JSON格式");return u}catch(t){throw console.error("Fetch请求错误:",t),t}})(),l=await Promise.race([r,t]);return clearTimeout(o),l}catch(l){return console.error("统一请求异常:",l),"AbortError"===l.name||"请求超时"===l.message?{success:!1,error:"请求超时，请检查网络连接"}:{success:!1,error:l.message||"请求失败，请稍后重试"}}}async function n(e,o){try{console.log("开始登录请求...",{username:e});const t=await s("/login","POST",{username:e,password:o});if(console.log("登录响应:",t),!t||"object"!=typeof t)throw new Error("服务器响应不是有效的JSON格式");return{success:t.success,error:t.error}}catch(t){return console.error("登录请求异常:",t),{success:!1,error:t.message||"登录失败，请稍后重试"}}}async function c(e,o,t=null){try{const r=t||(new Date).toISOString().split("T")[0];console.log("开始获取课表...",{username:e,date:r});const n=await s("/schedule","GET",{username:e,password:o,date:r});if(console.log("课表响应:",n),!n||"object"!=typeof n)throw new Error("服务器响应不是有效的JSON格式");if(n.success&&n.data){console.log("处理课表数据...");const e=n.data.map((e=>{const o=e.date;("2000-12-31"===o||o&&o.startsWith("2000-"))&&console.log(`课程 ${e.course||"未知"} 包含无效日期 ${o}`);const t=!o||"2000-12-31"===o||o&&o.startsWith("2000-")||!function(e){const o=/^\d{4}-\d{2}-\d{2}$/;if(!e.match(o))return!1;const t=new Date(e),r=t.getTime();if(!r&&0!==r)return!1;const s=t.getFullYear(),n=(new Date).getFullYear();return!(s<n-1||s>n+1)&&t.toISOString().slice(0,10)===e}(o),s={name:e.course||"",time:e.time||"",location:e.location||"",teacher:e.teacher||"",startTime:e.startTime||"",endTime:e.endTime||"",date:t?r:o};return t&&console.log(`日期转换: ${o||"无"} -> ${r}`),s}));return console.log("处理后的数据:",e),{success:!0,data:e}}return n}catch(r){return console.error("获取课表异常:",r),{success:!1,error:r.message||"获取课表失败，请稍后重试"}}}const a=(e,o)=>{const t=e.__vccOpts||e;for(const[r,s]of o)t[r]=s;return t};export{a as _,c as g,n as l};
