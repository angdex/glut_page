import{p as e,q as t}from"./index-NEbrRhS_.js";const r="undefined"!=typeof wx&&t,o="undefined"!=typeof window&&window.location&&window.location.host.indexOf("vercel")>-1;async function n(t,n,s,c=1e4){const a=`${o?"/api/proxy?url=":"https://xjeubhfwkdwt.sealoshzh.site/api"}${t}`;if(console.log(`尝试${n}请求:`,a),r)return new Promise(((t,r)=>{const o=e({url:a,method:n,data:s,header:{"Content-Type":"application/json",Accept:"application/json"},success:e=>{console.log("请求成功:",e.data),t(e.data)},fail:e=>{console.error("请求失败:",e),r(new Error(e.errMsg||"请求失败"))}});setTimeout((()=>{try{o.abort(),r(new Error("请求超时"))}catch(e){console.error("中止请求失败:",e)}}),c)}));try{let e,t;const r=new Promise(((e,r)=>{t=setTimeout((()=>r(new Error("请求超时"))),c)})),o=(async()=>{try{"undefined"!=typeof AbortController&&(e=new AbortController);const t={method:n,headers:{"Content-Type":"application/json",Accept:"application/json"}};"GET"!==n&&s&&(t.body=JSON.stringify(s)),e&&(t.signal=e.signal);let r=a;if("GET"===n&&s){const e=new URLSearchParams;Object.entries(s).forEach((([t,r])=>{null!=r&&e.append(t,r)})),r=`${a}${a.includes("?")?"&":"?"}${e.toString()}`}const o=await fetch(r,t);if(!o.ok)throw new Error(`请求失败: ${o.status}`);return await o.json()}catch(t){throw console.error("Fetch请求错误:",t),t}})(),i=await Promise.race([o,r]);return clearTimeout(t),i}catch(i){return console.error("统一请求异常:",i),"AbortError"===i.name||"请求超时"===i.message?{success:!1,error:"请求超时，请检查网络连接"}:{success:!1,error:"请求失败，请稍后重试"}}}async function s(e,t){try{const r=await n("/login","POST",{username:e,password:t});return{success:r.success,error:r.error}}catch(r){return console.error("登录请求异常:",r),{success:!1,error:"登录失败，请稍后重试"}}}async function c(e,t,r=null){try{const o=r||(new Date).toISOString().split("T")[0],s=await n("/schedule","GET",{username:e,password:t,date:o});if(s.success&&s.data){console.log("强制使用请求日期:",o);const e=s.data.map((e=>{const t=e.date;("2000-12-31"===t||t&&t.startsWith("2000-"))&&console.log(`课程 ${e.course||"未知"} 包含无效日期 ${t}`);const r=!t||"2000-12-31"===t||t&&t.startsWith("2000-")||!function(e){const t=/^\d{4}-\d{2}-\d{2}$/;if(!e.match(t))return!1;const r=new Date(e),o=r.getTime();if(!o&&0!==o)return!1;const n=r.getFullYear(),s=(new Date).getFullYear();return!(n<s-1||n>s+1)&&r.toISOString().slice(0,10)===e}(t),n={name:e.course||"",time:e.time||"",location:e.location||"",teacher:e.teacher||"",startTime:e.startTime||"",endTime:e.endTime||"",date:r?o:t};return r&&console.log(`日期转换: ${t||"无"} -> ${o}`),n}));return console.log("处理后的数据:",e),{success:!0,data:e}}return s}catch(o){return console.error("获取课表异常:",o),{success:!1,error:"获取课表失败，请稍后重试"}}}const a=(e,t)=>{const r=e.__vccOpts||e;for(const[o,n]of t)r[o]=n;return r};export{a as _,c as g,s as l};
