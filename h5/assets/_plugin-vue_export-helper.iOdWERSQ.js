import{p as e,q as o}from"./index-BMZ5TM4R.js";const t="undefined"!=typeof wx&&o,r="undefined"!=typeof window&&window.location&&window.location.host.indexOf("vercel")>-1;async function n(o,n,s,c=1e4){const a=`${r?"/api/proxy?url=":"https://xjeubhfwkdwt.sealoshzh.site/api"}${o}`;if(console.log(`尝试${n}请求:`,a),t)return new Promise(((o,t)=>{const r=e({url:a,method:n,data:s,header:{"Content-Type":"application/json",Accept:"application/json"},success:e=>{console.log("请求成功:",e.data),e.data&&"object"==typeof e.data?o(e.data):t(new Error("服务器响应不是有效的JSON格式"))},fail:e=>{console.error("请求失败:",e),t(new Error(e.errMsg||"请求失败"))}});setTimeout((()=>{try{r.abort(),t(new Error("请求超时"))}catch(e){console.error("中止请求失败:",e)}}),c)}));try{let e,o;const t=new Promise(((e,t)=>{o=setTimeout((()=>t(new Error("请求超时"))),c)})),r=(async()=>{try{"undefined"!=typeof AbortController&&(e=new AbortController);const o={method:n,headers:{"Content-Type":"application/json",Accept:"application/json"}};"GET"!==n&&s&&(o.body=JSON.stringify(s)),e&&(o.signal=e.signal);let t=a;if("GET"===n&&s){const e=new URLSearchParams;Object.entries(s).forEach((([o,t])=>{null!=t&&e.append(o,t)})),t=`${a}${a.includes("?")?"&":"?"}${e.toString()}`}console.log("发送请求:",{url:t,method:n,headers:o.headers,body:o.body});const r=await fetch(t,o);if(!r.ok)throw new Error(`请求失败: ${r.status}`);const c=r.headers.get("content-type");if(!c||!c.includes("application/json"))throw new Error("服务器响应不是有效的JSON格式");const i=await r.json();if(console.log("请求响应:",i),!i||"object"!=typeof i)throw new Error("服务器响应不是有效的JSON格式");return i}catch(o){throw console.error("Fetch请求错误:",o),o}})(),i=await Promise.race([r,t]);return clearTimeout(o),i}catch(i){return console.error("统一请求异常:",i),"AbortError"===i.name||"请求超时"===i.message?{success:!1,error:"请求超时，请检查网络连接"}:{success:!1,error:i.message||"请求失败，请稍后重试"}}}async function s(e,o){try{console.log("开始登录请求...");const t=await n("/login","POST",{username:e,password:o});if(console.log("登录响应:",t),!t||"object"!=typeof t)throw new Error("服务器响应不是有效的JSON格式");return{success:t.success,error:t.error}}catch(t){return console.error("登录请求异常:",t),{success:!1,error:t.message||"登录失败，请稍后重试"}}}async function c(e,o,t=null){try{const r=t||(new Date).toISOString().split("T")[0];console.log("开始获取课表...",{username:e,date:r});const s=await n("/schedule","GET",{username:e,password:o,date:r});if(console.log("课表响应:",s),!s||"object"!=typeof s)throw new Error("服务器响应不是有效的JSON格式");if(s.success&&s.data){console.log("处理课表数据...");const e=s.data.map((e=>{const o=e.date;("2000-12-31"===o||o&&o.startsWith("2000-"))&&console.log(`课程 ${e.course||"未知"} 包含无效日期 ${o}`);const t=!o||"2000-12-31"===o||o&&o.startsWith("2000-")||!function(e){const o=/^\d{4}-\d{2}-\d{2}$/;if(!e.match(o))return!1;const t=new Date(e),r=t.getTime();if(!r&&0!==r)return!1;const n=t.getFullYear(),s=(new Date).getFullYear();return!(n<s-1||n>s+1)&&t.toISOString().slice(0,10)===e}(o),n={name:e.course||"",time:e.time||"",location:e.location||"",teacher:e.teacher||"",startTime:e.startTime||"",endTime:e.endTime||"",date:t?r:o};return t&&console.log(`日期转换: ${o||"无"} -> ${r}`),n}));return console.log("处理后的数据:",e),{success:!0,data:e}}return s}catch(r){return console.error("获取课表异常:",r),{success:!1,error:r.message||"获取课表失败，请稍后重试"}}}const a=(e,o)=>{const t=e.__vccOpts||e;for(const[r,n]of o)t[r]=n;return t};export{a as _,c as g,s as l};
