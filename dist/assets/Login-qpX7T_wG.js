import{d as e,r as a,a as s,c as l,b as o,w as r,e as t,u as n,o as u,f as i,g as d,h as p,i as c,j as m,k as f,l as g,m as w,t as h,_ as v}from"./index-BtaR7VRe.js";const b={class:"login-container"},y=v(e({__name:"Login",setup(e){const v=n(),y=a(!1),_=a(""),x=s({username:"",password:""}),j={username:[{required:!0,message:"请输入学号",trigger:"blur"},{min:3,message:"学号长度不能小于3位",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},V=a(),k=async()=>{if(V.value)try{await V.value.validate(),y.value=!0,_.value="";const e=await fetch("https://xjeubhfwkdwt.sealoshzh.site/api/login",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({username:x.username,password:x.password})}),a=await e.json();a.success?(localStorage.setItem("username",x.username),localStorage.setItem("password",x.password),v.push("/schedule")):_.value=a.error||"登录失败，请检查用户名和密码"}catch(e){_.value=e instanceof Error?e.message:"登录失败，请稍后重试"}finally{y.value=!1}};return(e,a)=>{const s=t("el-input"),n=t("el-form-item"),v=t("el-button"),S=t("el-form"),I=t("el-alert"),q=t("el-card");return u(),l("div",b,[o(q,{class:"login-card"},{default:r((()=>[a[2]||(a[2]=i("div",{class:"login-header"},[i("h2",null,"桂林理工大学课表查询系统")],-1)),o(S,{ref_key:"loginFormRef",ref:V,model:x,rules:j,"label-position":"top",onSubmit:c(k,["prevent"])},{default:r((()=>[o(n,{label:"学号",prop:"username"},{default:r((()=>[o(s,{modelValue:x.username,"onUpdate:modelValue":a[0]||(a[0]=e=>x.username=e),placeholder:"请输入学号","prefix-icon":m(f)},null,8,["modelValue","prefix-icon"])])),_:1}),o(n,{label:"密码",prop:"password"},{default:r((()=>[o(s,{modelValue:x.password,"onUpdate:modelValue":a[1]||(a[1]=e=>x.password=e),type:"password",placeholder:"请输入密码","prefix-icon":m(g),"show-password":""},null,8,["modelValue","prefix-icon"])])),_:1}),o(n,null,{default:r((()=>[o(v,{type:"primary",loading:y.value,class:"login-button",onClick:k},{default:r((()=>[w(h(y.value?"登录中...":"登录"),1)])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"]),_.value?(u(),d(I,{key:0,title:_.value,type:"error","show-icon":"",class:"login-error"},null,8,["title"])):p("",!0)])),_:1})])}}}),[["__scopeId","data-v-96a6bc4b"]]);export{y as default};
